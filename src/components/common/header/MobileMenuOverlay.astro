---
import X from "@lucide/astro/icons/x";
import Facebook from "../../../images/brands/facebook.svg";
import Instagram from "../../../images/brands/instagram.svg";
import Tiktok from "../../../images/brands/tiktok.svg";
import { useI18n } from "../../../i18n";

type Props = {
  mobileMenuButtonId: string;
};

const { mobileMenuButtonId } = Astro.props;

const mobileMenuOverlayId = "mobile-menu-overlay";
const mobileMenuCloseButtonId = "mobile-menu-close-button";

// TODO: Update with actual social media URLs
const socialLinks = {
  facebook: "https://facebook.com/sellingdebrecen",
  instagram: "https://instagram.com/sellingdebrecen",
  tiktok: "https://tiktok.com/@sellingdebrecen",
};

const calendlyUrl = "https://calendly.com/kisszoltan"; // Update with actual Calendly URL

const { p, t } = useI18n(Astro);
---

<div
  id={mobileMenuOverlayId}
  class="md:hidden fixed w-full h-full inset-0 bg-navy/80 backdrop-blur-sm z-[200] flex flex-col transform translate-x-full opacity-0 transition-all duration-300 ease-in-out"
>
  <!-- Close Button -->
  <div class="flex justify-end p-6">
    <button
      id="mobile-menu-close-button"
      class="text-white/90 hover:text-white p-2 transition-colors"
      aria-label="Close menu"
    >
      <X class="w-7 h-7" />
    </button>
  </div>

  <!-- Menu Content -->
  <div
    class="flex flex-col flex-1 items-center justify-center px-8 pb-12 gap-12"
  >
    <!-- Menu Items -->
    <nav class="flex flex-col gap-6 text-center" aria-label="Mobile navigation">
      <a
        href={p("properties")}
        class="mobile-menu-link font-old-style text-white text-2xl tracking-wide"
      >
        {t("nav.properties")}
      </a>
      <a
        href={p("for-sellers")}
        class="mobile-menu-link font-old-style text-white text-2xl tracking-wide"
      >
        {t("nav.for-sellers")}
      </a>
      <a
        href={p("for-buyers")}
        class="mobile-menu-link font-old-style text-white text-2xl tracking-wide"
      >
        {t("nav.for-buyers")}
      </a>
      <a
        href={p("about")}
        class="mobile-menu-link font-old-style text-white text-2xl tracking-wide"
      >
        {t("nav.about")}
      </a>
    </nav>

    <!-- Divider -->
    <div class="w-24 h-px bg-white/20"></div>

    <!-- Schedule Button -->
    <a
      href={calendlyUrl}
      target="_blank"
      rel="noopener noreferrer"
      class="inline-flex items-center justify-center gap-3 px-8 py-4 border-2 border-white text-white font-system-ui text-sm tracking-widest uppercase hover:border-camel hover:bg-camel hover:text-navy transition-all duration-300"
    >
      <span>{t("nav.schedule")}</span>
    </a>

    <!-- Social Media Icons -->
    <div class="flex flex-col items-center gap-4">
      <p class="text-white/70 text-sm uppercase tracking-wider">
        {t("nav.follow-us")}
      </p>
      <div class="flex gap-4">
        <a
          href={socialLinks.facebook}
          target="_blank"
          rel="noopener noreferrer"
          class="flex items-center justify-center w-12 h-12 bg-camel"
          aria-label="Facebook"
        >
          <Facebook class="w-5 h-5 text-white" aria-hidden="true" />
        </a>
        <a
          href={socialLinks.instagram}
          target="_blank"
          rel="noopener noreferrer"
          class="flex items-center justify-center w-12 h-12 bg-camel"
          aria-label="Instagram"
        >
          <Instagram class="w-5 h-5 text-white" aria-hidden="true" />
        </a>
        <a
          href={socialLinks.tiktok}
          target="_blank"
          rel="noopener noreferrer"
          class="flex items-center justify-center w-12 h-12 bg-camel"
          aria-label="TikTok"
        >
          <Tiktok class="w-5 h-5 text-white" aria-hidden="true" />
        </a>
      </div>
    </div>
  </div>
</div>

<script
  data-mobile-menu-button-id={mobileMenuButtonId}
  data-mobile-menu-close-button-id={mobileMenuCloseButtonId}
  data-mobile-menu-overlay-id={mobileMenuOverlayId}
>
  (function initMobileMenu() {
    const dataset = document.currentScript.dataset;

    document.addEventListener("DOMContentLoaded", function mobileMenuInit() {
      const mobileMenuButton = document.getElementById(
        dataset.mobileMenuButtonId,
      );
      const mobileMenuOverlay = document.getElementById(
        dataset.mobileMenuOverlayId,
      );
      const mobileMenuLogo = document.getElementById("mobile-menu-logo");

      if (!mobileMenuButton || !mobileMenuOverlay || !mobileMenuLogo) {
        return;
      }

      const closeButton = document.getElementById(
        dataset.mobileMenuCloseButtonId,
      );

      let isMenuOpen = false;

      function toggleMenu() {
        isMenuOpen = !isMenuOpen;

        if (isMenuOpen) {
          // Show overlay
          mobileMenuOverlay.classList.remove("translate-x-full", "opacity-0");
          mobileMenuOverlay.classList.add("translate-x-0", "opacity-100");

          // Prevent body scroll
          document.body.style.overflow = "hidden";
        } else {
          // Hide overlay
          mobileMenuOverlay.classList.remove("translate-x-0", "opacity-100");
          mobileMenuOverlay.classList.add("translate-x-full", "opacity-0");

          // Restore body scroll
          document.body.style.overflow = "";
        }
      }

      // Toggle menu on button click
      mobileMenuButton.addEventListener("click", toggleMenu);

      // Close menu on close button click
      if (closeButton) {
        closeButton.addEventListener("click", toggleMenu);
      }

      // Close menu when clicking on links
      const menuLinks = mobileMenuOverlay.querySelectorAll(".mobile-menu-link");
      menuLinks.forEach((link) => {
        link.addEventListener("click", () => {
          if (isMenuOpen) {
            toggleMenu();
          }
        });
      });

      // Close menu when clicking outside
      mobileMenuOverlay.addEventListener("click", (e) => {
        if (e.target === mobileMenuOverlay) {
          toggleMenu();
        }
      });

      // Close menu on escape key
      document.addEventListener("keydown", (e) => {
        if (e.key === "Escape" && isMenuOpen) {
          toggleMenu();
        }
      });
    });
  })();
</script>
