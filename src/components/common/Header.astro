---
import Links from "../../util/links";
import X from "@lucide/astro/icons/x";
import Menu from "@lucide/astro/icons/menu";

const mobileMenuButtonId = "mobile-menu-button";
const mobileMenuOverlayId = "mobile-menu-overlay";
const hamburgerIconId = "hamburger-icon";
const xIconId = "x-icon";
const showDesktopNavigation = Astro.url.pathname !== "/";
---

<header
  x-data="{ scrolled: false }"
  x-init="
    window.addEventListener('scroll', () => {
      scrolled = window.scrollY > 50;
    });
  "
  :class="scrolled ? 'bg-navy/70 backdrop-blur-sm border-b border-camel/70' : 'bg-transparent'"
  class={(showDesktopNavigation ? "" : "block md:hidden") + " fixed top-0 left-0 right-0 z-[100] transition-colors duration-300"}
>
  <nav class="container mx-auto px-4 py-4">
    <!-- Desktop Navigation disabled -->
    {showDesktopNavigation && (<div class="hidden md:flex items-center justify-between">
      <!-- Logo -->
      <a href={Links.HOME} class="text-white text-xl font-semibold">
        Selling Debrecen
      </a>

      <!-- Menu Items -->
      <div class="flex items-center gap-8">
        <a
          href={Links.PROPERTIES}
          class="text-white hover:text-gray-300 transition-colors"
        >
          Ingatlanjaink
        </a>
        <a
          href={Links.FOR_SELLERS}
          class="text-white hover:text-gray-300 transition-colors"
        >
          Kínálóknak
        </a>
        <a
          href={Links.FOR_BUYERS}
          class="text-white hover:text-gray-300 transition-colors"
        >
          Keresőknek
        </a>
        <a
          href={Links.ABOUT}
          class="text-white hover:text-gray-300 transition-colors"
        >
          Rólunk
        </a>
        <a
          href={Links.SCHEDULE}
          class="bg-white text-black px-4 py-2 rounded hover:bg-gray-100 transition-colors"
        >
          Időpontfoglalás
        </a>
      </div>
    </div>)}

    <!-- Mobile Navigation -->
    <div class="md:hidden flex items-center justify-between">
      <!-- Logo -->
      <a href={Links.HOME} class="text-white text-xl font-semibold">
        Selling Debrecen
      </a>

      <div class="flex items-center gap-4">
        <!-- Schedule Button -->
        <a
          href={Links.SCHEDULE}
          class="font-system-ui bg-camel text-white px-4 py-2 rounded text-sm hover:bg-gray-100 tracking-wider transition-colors"
        >
          Időpontfoglalás
        </a>

        <!-- Drawer Toggle Button -->
        <button
          id={mobileMenuButtonId}
          class="text-white p-2 relative flex items-center justify-center"
          aria-label="Toggle menu"
        >
          <Menu
            id={hamburgerIconId}
            class="w-6 h-6 absolute transition-all duration-300 ease-in-out opacity-100 rotate-0 scale-100"
          />
          <X
            id={xIconId}
            class="w-6 h-6 absolute transition-all duration-300 ease-in-out opacity-0 rotate-90 scale-0"
          />
        </button>
      </div>
    </div>

    <!-- Mobile Drawer Menu -->
    <div
      id={mobileMenuOverlayId}
      class="md:hidden fixed inset-0 bg-black z-[200] flex flex-col transform translate-x-full opacity-0 transition-all duration-300 ease-in-out"
    >
      <!-- Close Button -->
      <div class="flex justify-end p-4">
        <button
          id="mobile-menu-close-button"
          class="text-white p-2"
          aria-label="Close menu"
        >
          <X class="w-6 h-6" />
        </button>
      </div>

      <!-- Menu Items -->
      <div
        class="flex flex-col gap-6 text-center flex-1 items-center justify-center"
      >
        <a
          href={Links.PROPERTIES}
          class="mobile-menu-link text-white hover:text-gray-300 transition-colors text-lg"
        >
          Ingatlanjaink
        </a>
        <a
          href={Links.FOR_SELLERS}
          class="mobile-menu-link text-white hover:text-gray-300 transition-colors text-lg"
        >
          Kínálóknak
        </a>
        <a
          href={Links.FOR_BUYERS}
          class="mobile-menu-link text-white hover:text-gray-300 transition-colors text-lg"
        >
          Keresőknek
        </a>
        <a
          href={Links.ABOUT}
          class="mobile-menu-link text-white hover:text-gray-300 transition-colors text-lg"
        >
          Rólunk
        </a>
      </div>
    </div>
  </nav>
</header>

<script
  data-mobile-menu-button-id={mobileMenuButtonId}
  data-mobile-menu-overlay-id={mobileMenuOverlayId}
  data-hamburger-icon-id={hamburgerIconId}
  data-x-icon-id={xIconId}
>
  (function initMobileMenu() {
    const dataset = document.currentScript.dataset;

    document.addEventListener("DOMContentLoaded", function mobileMenuInit() {
      const mobileMenuButton = document.getElementById(
        dataset.mobileMenuButtonId,
      );
      const mobileMenuOverlay = document.getElementById(
        dataset.mobileMenuOverlayId,
      );

      if (!mobileMenuButton || !mobileMenuOverlay) {
        return;
      }

      const hamburgerIcon = document.getElementById(dataset.hamburgerIconId);
      const xIcon = document.getElementById(dataset.xIconId);
      const closeButton = document.getElementById("mobile-menu-close-button");

      let isMenuOpen = false;

      function toggleMenu() {
        isMenuOpen = !isMenuOpen;

        if (isMenuOpen) {
          // Show overlay
          mobileMenuOverlay.classList.remove("translate-x-full", "opacity-0");
          mobileMenuOverlay.classList.add("translate-x-0", "opacity-100");

          // Toggle icons - show X, hide hamburger
          hamburgerIcon.classList.add("opacity-0", "rotate-90", "scale-0");
          hamburgerIcon.classList.remove(
            "opacity-100",
            "rotate-0",
            "scale-100",
          );
          xIcon.classList.add("opacity-100", "rotate-0", "scale-100");
          xIcon.classList.remove("opacity-0", "rotate-90", "scale-0");

          // Prevent body scroll
          document.body.style.overflow = "hidden";
        } else {
          // Hide overlay
          mobileMenuOverlay.classList.remove("translate-x-0", "opacity-100");
          mobileMenuOverlay.classList.add("translate-x-full", "opacity-0");

          // Toggle icons - show hamburger, hide X
          hamburgerIcon.classList.add("opacity-100", "rotate-0", "scale-100");
          hamburgerIcon.classList.remove("opacity-0", "rotate-90", "scale-0");
          xIcon.classList.add("opacity-0", "rotate-90", "scale-0");
          xIcon.classList.remove("opacity-100", "rotate-0", "scale-100");

          // Restore body scroll
          document.body.style.overflow = "";
        }
      }

      // Toggle menu on button click
      mobileMenuButton.addEventListener("click", toggleMenu);

      // Close menu on close button click
      if (closeButton) {
        closeButton.addEventListener("click", toggleMenu);
      }

      // Close menu when clicking on links
      const menuLinks = mobileMenuOverlay.querySelectorAll(".mobile-menu-link");
      menuLinks.forEach((link) => {
        link.addEventListener("click", () => {
          if (isMenuOpen) {
            toggleMenu();
          }
        });
      });

      // Close menu when clicking outside
      mobileMenuOverlay.addEventListener("click", (e) => {
        if (e.target === mobileMenuOverlay) {
          toggleMenu();
        }
      });

      // Close menu on escape key
      document.addEventListener("keydown", (e) => {
        if (e.key === "Escape" && isMenuOpen) {
          toggleMenu();
        }
      });
    });
  })();
</script>
